---
//path: /src/components/messages/ChatrecommendationBar.astro
import {classNames} from "../../styles/classStyles";

---
<script>
    import {  
        $textAreaValue, 
        updateTextareaValuerecommendationStateEvent,  
        $recommendations,
        updateMessagesStateEvent
    } from "../../stores/store";
    import {classNames} from "../../styles/classStyles";
    const buttonElement = document.querySelector<HTMLButtonElement>('#recommendation');
    const textareaElement = document.querySelector("#chat-bar-textarea") as HTMLTextareaElement;
    
    // Render recommendation Buttons
    function renderMyrecommendations(recommendation: any) {
        const recommendationHtml = `
            <button
              id="recommendation-button"
              class="${classNames("recommendationButton")}"
            >
              ${recommendation}
            </button>
        `;
        buttonElement.innerHTML += recommendationHtml;
    }
    let unsubscribe;
    unsubscribe;
    function initialize() {
        unsubscribe = $recommendations.subscribe(updatedrecommendations => {  
            buttonElement.innerHTML = '';
            updatedrecommendations.forEach(renderMyrecommendations);
        }); 
          
    }
    initialize();

    // CREATE MESSAGE
      function createMessage(event: Event) {
      event.preventDefault();
      const messageContent = textareaElement.value.trim();
      if (!messageContent) {
        alert("Please fill in the message.");
        return;
      }
      updateMessagesStateEvent(messageContent);
      textareaElement.value = '';
    }

    // UPDATE TEXTAREA VALUE ON recommendation BUTTON CLICK
    document.addEventListener("click", (event) => {
        const target = event.target as HTMLButtonElement;
        if (target.matches("#recommendation-button")) {
            const recommendation = target.innerText;
            $textAreaValue.set(recommendation);
            return;
        }
    });

    //ADD KEYDOWN EVENT LISTENER TO recommendation BUTTONS
    document.addEventListener("keydown", (event: KeyboardEvent) => {
        const target = event.target as HTMLButtonElement;
        if (target.matches("#recommendation-button")) {
            const recommendation = target.innerText;
            if (event.key === "Enter") {
                createMessage(event);
                return;
            }
        }
    });
 
  // UPDATE recommendation STATE STORE 
    $textAreaValue.subscribe((recommendation) => {
      textareaElement.value = recommendation;
    });
</script>

<div id="recommendation" class={classNames("recommendation")}>
</div>
