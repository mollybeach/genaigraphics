---
//ChatMessages.astro
---
<script>
    import { allMessages } from "../stores/store";
    const targetDiv = document.getElementById("messageParent") as HTMLDivElement;

    function renderMyMessages(message: any) {
      const messageHtml = `
        <div class="${message.sender === 'me' ? 'col-start-6 col-end-13' : 'col-start-1 col-end-8'} p-3 rounded-lg">
          <div class="flex flex-row items-center ${message.sender === 'me' ? 'flex-row-reverse' : ''}">
            <div class="flex items-center justify-center h-10 w-10 rounded-full bg-purple-500 flex-shrink-0">
              <img class="rounded-full" src=${message.image} alt=${message.name} />
            </div>
            <div class="relative ml-3 text-sm ${message.sender === 'you' ? 'bg-white' : 'bg-purple-100'} py-2 px-4 shadow rounded-xl">
              ${message.message} 
            </div>
          </div>
        </div>
      `;
      targetDiv.innerHTML += messageHtml; 
    }
    
    let unsubscribe;
    console.log(unsubscribe);
    function initialize() {
        unsubscribe = allMessages.subscribe(updatedMessages => {
            targetDiv.innerHTML = '';
            updatedMessages.forEach(renderMyMessages);
        });
    }
    
    initialize();
</script>
    
<section class="flex flex-col h-full overflow-x-auto mb-4">
    <div id="messageParent" class="grid grid-cols-12 gap-y-2"></div>
</section>

    
